# RaspberryPierMix

## æ¦‚è¿°

RaspberryPierMixæ˜¯ä¸€ä¸ªåŸºäºRaspberry Piçš„ä¼ æ„Ÿå™¨æ•°æ®é‡‡é›†å’Œæ‰§è¡Œå™¨æ§åˆ¶ç³»ç»Ÿï¼Œé‡‡ç”¨MQTTæ¶ˆæ¯ä¼ é€’æœºåˆ¶å®ç°æ¨¡å—åŒ–è®¾è®¡ã€‚

## é¡¹ç›®ç»“æ„

```
RaspberryPierMix/
â”œâ”€â”€ sensors/                # ä¼ æ„Ÿå™¨æ¨¡å—
â”‚   â”œâ”€â”€ temperature_humidity/  # æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨
â”‚   â”œâ”€â”€ pir/                  # PIRè¿åŠ¨æ£€æµ‹ä¼ æ„Ÿå™¨
â”‚   â”œâ”€â”€ button/               # æŒ‰é’®ä¼ æ„Ÿå™¨
â”‚   â””â”€â”€ potentiometer/        # ç”µä½å™¨ä¼ æ„Ÿå™¨
â”œâ”€â”€ actuators/              # æ‰§è¡Œå™¨æ¨¡å—
â”‚   â”œâ”€â”€ oled/                # OLEDæ˜¾ç¤ºæ¨¡å—
â”‚   â”œâ”€â”€ buzzer/              # èœ‚é¸£å™¨æ¨¡å—
â”‚   â””â”€â”€ audio/               # éŸ³é¢‘æ’­æ”¾æ¨¡å—
â”œâ”€â”€ manager/                # ä¸šåŠ¡ç®¡ç†å™¨æ¨¡å—
â”‚   â”œâ”€â”€ oled_manager/        # OLEDä¸šåŠ¡ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ oled_manager.py   # OLEDç®¡ç†å™¨ä¸»ç¨‹åº
â”‚   â”‚   â”œâ”€â”€ config.ini        # OLEDä¸šåŠ¡é…ç½®
â”‚   â”‚   â””â”€â”€ README.md         # OLEDä¸šåŠ¡è¯´æ˜
â”œâ”€â”€ common/                 # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ mqtt_base.py        # MQTTåŸºç¡€ç±»
â”‚   â””â”€â”€ requirements.txt     # å…¬å…±ä¾èµ–
â”œâ”€â”€ services/               # ç³»ç»ŸæœåŠ¡æ–‡ä»¶
â”œâ”€â”€ manager_config.ini      # å…¨å±€é…ç½®æ–‡ä»¶
â”œâ”€â”€ install.sh              # å®‰è£…è„šæœ¬
â”œâ”€â”€ uninstall.sh            # å¸è½½è„šæœ¬
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## æ¶æ„è®¾è®¡

### æ¨¡å—åŒ–è®¾è®¡

é¡¹ç›®é‡‡ç”¨**æŒ‰ä¸šåŠ¡åˆ’åˆ†çš„æ¨¡å—åŒ–è®¾è®¡**ï¼š

1. **ä¼ æ„Ÿå™¨æ¨¡å—** (`sensors/`) - æ•°æ®é‡‡é›†å±‚
   - æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨
   - PIRè¿åŠ¨æ£€æµ‹ä¼ æ„Ÿå™¨
   - æŒ‰é’®ä¼ æ„Ÿå™¨
   - ç”µä½å™¨ä¼ æ„Ÿå™¨

2. **æ‰§è¡Œå™¨æ¨¡å—** (`actuators/`) - æ§åˆ¶æ‰§è¡Œå±‚
   - OLEDæ˜¾ç¤ºæ¨¡å—
   - èœ‚é¸£å™¨æ¨¡å—
   - éŸ³é¢‘æ’­æ”¾æ¨¡å—

3. **ä¸šåŠ¡ç®¡ç†å™¨æ¨¡å—** (`manager/`) - ä¸šåŠ¡é€»è¾‘å±‚
   - **OLEDç®¡ç†å™¨** (`oled_manager/`) - å¤„ç†OLEDæ˜¾ç¤ºç›¸å…³ä¸šåŠ¡
   - **å…¶ä»–ç®¡ç†å™¨** - æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ‰©å±•

### æ¶ˆæ¯æµç¨‹

```
ä¼ æ„Ÿå™¨ â†’ MQTT â†’ ä¸šåŠ¡ç®¡ç†å™¨ â†’ MQTT â†’ æ‰§è¡Œå™¨
```

## ä¸šåŠ¡ç®¡ç†å™¨

### OLEDç®¡ç†å™¨ (`manager/oled_manager/`)

ç»Ÿä¸€çš„ä¸šåŠ¡ç®¡ç†å™¨ï¼Œå¤„ç†ç›¸å…³ä¼ æ„Ÿå™¨æ•°æ®å¹¶æ ¹æ®ä¸šåŠ¡é€»è¾‘è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚

**æ”¯æŒçš„ä¼ æ„Ÿå™¨ï¼š**

#### OLEDç›¸å…³ä¼ æ„Ÿå™¨ï¼ˆå¤æ‚ä¸šåŠ¡é€»è¾‘ï¼‰
- `temperature_humidity` - æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨
- `pir_motion` - PIRè¿åŠ¨æ£€æµ‹ä¼ æ„Ÿå™¨


**ä¸»è¦åŠŸèƒ½ï¼š**
- OLEDæ˜¾ç¤ºæ§åˆ¶ï¼ˆæ¸©æ¹¿åº¦æ˜¾ç¤ºã€è¿åŠ¨æ£€æµ‹å“åº”ï¼‰
- å®šæ—¶å™¨ç®¡ç†ï¼ˆ10åˆ†é’Ÿè‡ªåŠ¨åˆ‡æ¢ï¼‰
- çŠ¶æ€ç®¡ç†


## ğŸ”§ å¿«é€Ÿéƒ¨ç½²ä¸æœåŠ¡ç®¡ç†

### ä¼ ç»Ÿæ–¹å¼ï¼ˆç³»ç»ŸæœåŠ¡ï¼‰

1. **è¿è¡Œå®‰è£…è„šæœ¬**ï¼ˆè‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€ç”Ÿæˆå¹¶å®‰è£… systemd æœåŠ¡ï¼‰ï¼š
   ```bash
   chmod +x install.sh
   sudo ./install.sh
   ```

2. **å¸è½½æœåŠ¡**ï¼ˆåœæ­¢ã€ç¦ç”¨å¹¶åˆ é™¤æ‰€æœ‰ systemd æœåŠ¡ï¼‰ï¼š
   ```bash
   chmod +x uninstall.sh
   sudo ./uninstall.sh
   ```

2. **è°ƒè¯•ä¸ç®¡ç† systemd æœåŠ¡**

   - **æŸ¥çœ‹æœåŠ¡çŠ¶æ€**
     ```bash
     sudo systemctl status temperature_humidity-publisher.service
     ```
   - **å¯åŠ¨æœåŠ¡**
     ```bash
     sudo systemctl start temperature_humidity-publisher.service
     ```
   - **é‡å¯æœåŠ¡**
     ```bash
     sudo systemctl restart temperature_humidity-publisher.service
     ```
   - **åœæ­¢æœåŠ¡**
     ```bash
     sudo systemctl stop temperature_humidity-publisher.service
     ```
   - **å®æ—¶æŸ¥çœ‹æœåŠ¡æ—¥å¿—**
     ```bash
     sudo journalctl -u temperature_humidity-publisher.service -f
     ```
   - **ä¿®æ”¹æœåŠ¡æ–‡ä»¶åéœ€é‡è½½é…ç½®**
     ```bash
     sudo systemctl daemon-reload
     sudo systemctl restart temperature_humidity-publisher.service
     ```

   - **å®Œå…¨å¸è½½æœåŠ¡**
     ```bash
     sudo ./uninstall.sh
     ```
     
   - **æ‰‹åŠ¨è°ƒè¯•ä¸æµ‹è¯•**

      è‹¥ä»…éœ€åœ¨å‘½ä»¤è¡Œä¸‹éªŒè¯å‘å¸ƒå’Œè®¢é˜…ï¼Œå¯æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
      
      ```bash
      mosquitto_sub -t sensor/temperature_humidity -v
      mosquitto_sub -t sensor/pir_motion -v
      ```
      
      ```bash
      mosquitto_pub -t actuator/test -m '{"cmd": "ON", "id": "node1"}'
      ```

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„ä¸šåŠ¡ç®¡ç†å™¨

1. åœ¨ `manager/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ç®¡ç†å™¨ç›®å½•
2. åˆ›å»ºæ ‡å‡†çš„æ¨¡å—ç»“æ„ï¼š
   ```
   manager/new_manager/
   â”œâ”€â”€ __init__.py
   â”œâ”€â”€ new_manager.py
   â”œâ”€â”€ config.ini
   â””â”€â”€ README.md
   ```
3. ç»§æ‰¿ `MQTTSubscriber` åŸºç±»
4. å®ç°ç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘
5. æ›´æ–° `manager/README.md` æ–‡æ¡£

### ç¤ºä¾‹ï¼šLEDç®¡ç†å™¨

```python
class LEDManager(MQTTSubscriber):
    def __init__(self, config):
        super().__init__(config)
        self.add_subscription('sensor')
        
    def handle_message(self, topic: str, payload: Dict[str, Any]):
        # å®ç°LEDç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘
        pass
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **MQTTè¿æ¥å¤±è´¥**
   - æ£€æŸ¥MQTTä»£ç†æ˜¯å¦è¿è¡Œ
   - éªŒè¯é…ç½®æ–‡ä»¶ä¸­çš„è¿æ¥å‚æ•°

2. **æ¶ˆæ¯å¤„ç†é”™è¯¯**
   - æ£€æŸ¥ä¼ æ„Ÿå™¨æ¶ˆæ¯æ ¼å¼
   - æŸ¥çœ‹æ—¥å¿—è¾“å‡º

3. **ç®¡ç†å™¨å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥Pythonä¾èµ–
   - éªŒè¯æ–‡ä»¶è·¯å¾„

### æµ‹è¯•æ£€æŸ¥æ¸…å•

åœ¨è¿è¡Œç³»ç»Ÿä¹‹å‰ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] MQTTä»£ç†æ­£åœ¨è¿è¡Œ
- [ ] æ‰€æœ‰ä¾èµ–å·²å®‰è£…
- [ ] é…ç½®æ–‡ä»¶æ­£ç¡®
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] ä¼ æ„Ÿå™¨å’Œæ‰§è¡Œå™¨æ­£å¸¸å·¥ä½œ

## ç‰ˆæœ¬å†å²

- **v3.0** - åˆ›å»ºmanageræ¨¡å—ï¼ŒæŒ‰ä¸šåŠ¡åˆ’åˆ†ç®¡ç†å™¨
- **v2.0** - æ¨¡å—åŒ–é‡æ„ï¼Œåˆ†ç¦»OLEDå’Œç®€å•ç®¡ç†å™¨
- **v1.0** - ç»Ÿä¸€ç®¡ç†å™¨ï¼Œæ‰€æœ‰é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­

